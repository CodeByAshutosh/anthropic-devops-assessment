name: Python-App-CI-CD

on:
  push:
    branches: [ main, staging ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Tests
        run: pip install -r requirements.txt && pytest # Automated testing
      - name: Docker Build & Scan
        run: |
          docker build -t my-app:${{ github.sha }} .
          # Placeholder for security scan 
          echo "Scanning image..."

  deploy-staging:
    needs: build-and-test
    if: github.ref == 'refs/heads/staging'
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Staging
        run: echo "Deploying to Kubernetes Staging"

  deploy-production:
    needs: build-and-test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    environment: production # Production approval gate 
    steps:
      - name: Deploy to Production
        run: echo "Deploying to Kubernetes Production"